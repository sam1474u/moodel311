{"version":3,"file":"steps.min.js","sources":["../src/steps.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport PendingJS from 'core/pending';\n\n/**\n * Enhancements for the step definitions page.\n *\n * @module tool_behat/steps\n * @copyright 2022 Catalyst IT EU\n * @author Mark Johnson <mark.johnson@catalyst-eu.net>\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n/**\n * Call the get_entity_generator web service function\n *\n * Takes the name of an entity generator and returns an object containing a list of the required fields.\n *\n * @param {String} entityType\n * @returns {Promise}\n */\nconst getGeneratorEntities = (entityType) => Ajax.call([{\n    methodname: 'tool_behat_get_entity_generator',\n    args: {entitytype: entityType}\n}])[0];\n\n/**\n * Render HTML for required fields\n *\n * Takes the entity data returned from getGeneratorEntities and renders the HTML to display the required fields.\n *\n * @param {String} entityData\n * @return {Promise}\n */\nconst getRequiredFieldsContent = (entityData) => {\n    if (!entityData.required?.length) {\n        return Promise.resolve({\n            html: '',\n            js: ''\n        });\n    }\n    return Templates.renderForPromise('tool_behat/steprequiredfields', {fields: entityData.required});\n};\n\nexport const init = () => {\n    // When an entity is selected in the \"the following exist\" step, fetch and display the required fields.\n    document.addEventListener('change', async(e) => {\n        const entityElement = e.target.closest('.entities');\n        const stepElement = e.target.closest('.stepcontent');\n        if (!entityElement || !stepElement) {\n            return;\n        }\n\n        const pendingPromise = new PendingJS('tool_behat/steps:change');\n\n        const entityData = await getGeneratorEntities(e.target.value);\n        const {html, js} = await getRequiredFieldsContent(entityData);\n\n        const stepRequiredFields = stepElement.querySelector('.steprequiredfields');\n        if (stepRequiredFields) {\n            await Templates.replaceNode(stepRequiredFields, html, js);\n        } else {\n            await Templates.appendNodeContents(stepElement, html, js);\n        }\n        pendingPromise.resolve();\n    });\n};\n"],"names":["_ajax","_interopRequireDefault","_templates","_pending","getRequiredFieldsContent","entityData","_entityData$required","required","length","Templates","renderForPromise","fields","Promise","resolve","html","js","_ref","document","addEventListener","regeneratorRuntime","mark","e","entityElement","stepElement","pendingPromise","_yield$getRequiredFie","stepRequiredFields","wrap","_context","prev","next","target","closest","abrupt","PendingJS","default","entityType","value","Ajax","call","methodname","args","entitytype","sent","querySelector","replaceNode","appendNodeContents","stop","_callee","_x","apply","this","arguments"],"mappings":"0fAeAA,MAAAC,uBAAAD,OACAE,WAAAD,uBAAAC,YACAC,SAAAF,uBAAAE;;;;;;;;;AAmBA,IAaMC,yBAA2B,SAACC,YAAe,IAAAC,qBACzC,eAAAA,qBAACD,WAAWE,0CAAXD,qBAAqBE,OAMnBC,WAAUC,QAAAA,iBAAiB,gCAAiC,CAACC,OAAQN,WAAWE,WAL5EK,QAAQC,QAAQ,CACnBC,KAAM,GACNC,GAAI,IAIf,gBAEmB,WAEhB,OAAAC,KAAAC,SAASC,iBAAiB,aAA1BC,mBAAAC,MAAoC,iBAAMC,GAAN,IAAAC,cAAAC,YAAAC,eAAAnB,WAAAoB,sBAAAX,KAAAC,GAAAW,mBAAA,OAAAP,mBAAAQ,MAAA,SAAAC,UAAA,OAAA,OAAAA,SAAAC,KAAAD,SAAAE,MAAA,KAAA,EAAA,GAC1BR,cAAgBD,EAAEU,OAAOC,QAAQ,aACjCT,YAAcF,EAAEU,OAAOC,QAAQ,gBAChCV,eAAkBC,YAHS,CAAAK,SAAAE,KAAA,EAAA,KAAA,CAAA,OAAAF,SAAAK,OAAA,UAAA,KAAA,EAAA,OAO1BT,eAAiB,IAAIU,SAAJC,QAAc,2BAPLP,SAAAE,KAAA,EAzBVM,WAkCwBf,EAAEU,OAAOM,MAlClBC,MAAAA,QAAKC,KAAK,CAAC,CACpDC,WAAY,kCACZC,KAAM,CAACC,WAAYN,eACnB,GAsBoC,KAAA,EAUPhC,OADnBC,WAT0BuB,SAAAe,KAAAf,SAAAE,KAAA,GAUP1B,yBAAyBC,YAVlB,KAAA,GAAA,GAAAoB,sBAAAG,SAAAe,KAUzB7B,2BAAAA,KAAMC,yBAAAA,KAEPW,mBAAqBH,YAAYqB,cAAc,wBAZrB,CAAAhB,SAAAE,KAAA,GAAA,KAAA,CActBrB,OAdsBmB,SAAAE,KAAA,GActBrB,WAAAA,QAAUoC,YAAYnB,mBAAoBZ,KAAMC,IAd1B,KAAA,GAAAa,SAAAE,KAAA,GAAA,MAAA,KAAA,GAgBtBrB,OAhBsBmB,SAAAE,KAAA,GAgBtBrB,WAAAA,QAAUqC,mBAAmBvB,YAAaT,KAAMC,IAhB1B,KAAA,GAkBhCS,eAAeX,UAlBiB,KAAA,GAAA,IAAA,MAAA,OAAAe,SAAAmB,OAzBX,IAACX,UAyBU,GAAAY,QAApC,IAAAhC,oTAAA,SAAAiC,IAAA,OAAAjC,KAAAkC,MAAAC,KAAAC,UAAA,GAoBH"}